# C++ Testbench

> C++ testbench for ALU verification using Verilator

This directory contains C++ testbench code for cycle-accurate ALU simulation.

---

## Overview

**Purpose:** Cycle-accurate ALU verification using C++ and Verilator

**What it does:**
- Compiles SystemVerilog ALU to C++ via Verilator
- Executes test vectors with cycle-accurate timing
- Validates ALU behavior at hardware simulation level
- Provides faster simulation than traditional Verilog simulators

---

## Files

### `alu_tb.cpp`

**Purpose:** C++ testbench implementation

**Features:**
- Loads test vectors from JSON
- Drives ALU inputs with proper timing
- Monitors ALU outputs
- Compares actual vs. expected results
- Reports pass/fail statistics

**Implementation:**
- Uses Verilator-generated C++ model
- Cycle-accurate simulation
- Hardware-level verification

---

### `Makefile`

**Purpose:** Build configuration for C++ testbench

**Targets:**
- `make` - Build testbench executable
- `make clean` - Remove build artifacts
- `make run` - Build and run testbench

**Dependencies:**
- Verilator (compiles SystemVerilog to C++)
- C++ compiler (g++ or clang++)
- SystemVerilog ALU source (`sim/FPGA/src/ALU.sv`)

---

### `alu_tb` (executable)

**Purpose:** Compiled testbench executable

**Generated by:** `make` command  
**Usage:** `./alu_tb [test_vectors.json]`

---

## Building

### Prerequisites

```bash
# Install Verilator
# macOS:
brew install verilator

# Linux:
sudo apt-get install verilator

# Or build from source: https://github.com/verilator/verilator
```

### Build Steps

```bash
cd test/cpp

# Build testbench
make

# Clean build artifacts
make clean
```

---

## Running Tests

```bash
cd test/cpp

# Run with demo vectors (default)
./alu_tb ../vectors/demo.json

# Run with exhaustive vectors
./alu_tb ../vectors/exhaustive.json

# Run without arguments (uses default vectors)
./alu_tb
```

---

## How It Works

### 1. Verilator Compilation

Verilator compiles SystemVerilog ALU to optimized C++:
```
sim/FPGA/src/ALU.sv â†’ C++ model (VALU.h, VALU.cpp)
```

### 2. Testbench Execution

C++ testbench:
1. Loads test vectors from JSON
2. Instantiates Verilator ALU model
3. Drives inputs for each test
4. Samples outputs after propagation delay
5. Compares with expected results

### 3. Cycle-Accurate Timing

Unlike Python golden model:
- Models actual propagation delays
- Respects hardware timing constraints
- Validates signal timing relationships
- More accurate than functional simulation

---

## Advantages Over Python Tests

| Aspect | Python (test_alu.py) | C++ Verilator (alu_tb.cpp) |
|--------|---------------------|----------------------------|
| **Timing** | Functional (instant) | Cycle-accurate (hardware delays) |
| **Speed** | Fast (~9s for 1.24M tests) | Very fast (~2s for 1.24M tests) |
| **Accuracy** | Golden model | Hardware-level simulation |
| **Dependencies** | Python only | Verilator + C++ compiler |
| **Use case** | Functional verification | Hardware verification |

**Best practice:** Use Python for development, C++ Verilator for final verification.

---

## Performance

| Metric | Value |
|--------|-------|
| **Compilation time** | ~10-30 seconds (one-time) |
| **Execution speed** | ~2 seconds for 1.24M tests |
| **Throughput** | ~600,000 tests/second |
| **Speedup vs Python** | ~4-5x faster |

---

## Integration with Main Test Suite

The C++ testbench complements the main Python test suite:

**Python tests (`test_alu.py`):**
- Fast functional verification
- Easy to modify and extend
- Good for CI/CD
- No hardware dependencies

**C++ Verilator (`alu_tb.cpp`):**
- Hardware-level verification
- Cycle-accurate timing
- Production-grade testing
- Requires Verilator installation

**Recommendation:** Run Python tests for development, C++ tests for final validation.

---

## Troubleshooting

### "Verilator not found"

**Solution:** Install Verilator:
```bash
brew install verilator  # macOS
sudo apt-get install verilator  # Linux
```

### "ALU.sv not found"

**Solution:** Ensure SystemVerilog source exists:
```bash
ls ../../sim/FPGA/src/ALU.sv
```

### Build errors

**Solution:** Clean and rebuild:
```bash
make clean
make
```

---

## Related Files

- **[ALU.sv](../../sim/FPGA/src/ALU.sv)** - SystemVerilog ALU source
- **[test_alu.py](../test_alu.py)** - Python test suite (functional)
- **[vectors/](../vectors/README.md)** - Test vector files

---

**Last Updated:** 2026-01-16  
**See Also:** [Test Suite](../README.md) | [Industry Standard Testing](../INDUSTRY_STANDARD_TESTING.md)
